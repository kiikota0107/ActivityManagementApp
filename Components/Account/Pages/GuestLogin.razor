@page "/Account/GuestLogin"
@using ActivityManagementApp.Data
@using Microsoft.AspNetCore.Identity
@inject UserManager<ApplicationUser> UserManager
@inject SignInManager<ApplicationUser> SignInManager
@inject NavigationManager Nav
@inject IConfiguration Config

@if (ErrorMessage != null)
{
    <div class="text-danger">@ErrorMessage</div>
    <p><a href="/Account/Login">ログインページに戻る</a></p>
}
else
{
    <h3>ゲストユーザとしてログインしています...</h3>
}

@code {
    private string? ErrorMessage;

    protected override async Task OnInitializedAsync()
    {
        var email = Config["GuestUser:Email"]!;
        var password = Config["GuestUser:password"]!;

        var result = await SignInManager.PasswordSignInAsync(
            email,
            password,
            false,
            lockoutOnFailure: false);

        if (result.Succeeded)
        {
            Nav.NavigateTo("/", forceLoad: true);
        }
        else
        {
            ErrorMessage = "申し訳ありませんが、現在ゲストユーザは利用できません。";
        }
    }
}